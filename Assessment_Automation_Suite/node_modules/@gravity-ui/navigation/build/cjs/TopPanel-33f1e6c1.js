'use strict';

var React = require('react');
var uikit = require('@gravity-ui/uikit');
var debounce = require('./debounce-8772fd80.js');
var utils = require('./utils-db3e03c2.js');
require('./cn-9933321a.js');
require('@bem-react/classname');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);

const G_ROOT_CLASS_NAME = 'g-root';
const useRefHeight = (ref) => {
    const [topHeight, setTopHeight] = React__default["default"].useState(0);
    React__default["default"].useEffect(() => {
        if (ref.current) {
            const { current } = ref;
            setTopHeight(current.clientHeight);
        }
    }, [ref]);
    return topHeight;
};
const useAsideHeaderTopPanel = ({ topAlert, }) => {
    const topRef = React__default["default"].useRef(null);
    const topHeight = useRefHeight(topRef);
    const setAsideTopPanelHeight = React__default["default"].useCallback((clientHeight) => {
        const gRootElement = document
            .getElementsByClassName(G_ROOT_CLASS_NAME)
            .item(0);
        gRootElement === null || gRootElement === void 0 ? void 0 : gRootElement.style.setProperty('--gn-aside-top-panel-height', clientHeight + 'px');
    }, []);
    const updateTopSize = React__default["default"].useCallback(() => {
        var _a;
        if (topRef.current) {
            setAsideTopPanelHeight(((_a = topRef.current) === null || _a === void 0 ? void 0 : _a.clientHeight) || 0);
        }
    }, [topRef, setAsideTopPanelHeight]);
    React__default["default"].useLayoutEffect(() => {
        const updateTopSizeDebounce = debounce.debounce_1(updateTopSize, 200, { leading: true });
        if (topAlert) {
            window.addEventListener('resize', updateTopSizeDebounce);
            updateTopSizeDebounce();
        }
        return () => {
            window.removeEventListener('resize', updateTopSizeDebounce);
            setAsideTopPanelHeight(0);
        };
    }, [topAlert, topHeight, topRef, updateTopSize, setAsideTopPanelHeight]);
    return {
        topRef,
        updateTopSize,
    };
};

const TopPanel = ({ topAlert }) => {
    const { topRef, updateTopSize } = useAsideHeaderTopPanel({ topAlert });
    const [opened, setOpened] = React__default["default"].useState(true);
    const handleClose = React__default["default"].useCallback(() => {
        var _a;
        setOpened(false);
        (_a = topAlert === null || topAlert === void 0 ? void 0 : topAlert.onCloseTopAlert) === null || _a === void 0 ? void 0 : _a.call(topAlert);
    }, [topAlert]);
    React__default["default"].useEffect(() => {
        if (!opened) {
            updateTopSize();
        }
    }, [opened, updateTopSize]);
    if (!topAlert || !topAlert.message) {
        return null;
    }
    return (React__default["default"].createElement("div", { ref: topRef, className: utils.b('pane-top', { opened }) }, opened && (React__default["default"].createElement(React__default["default"].Fragment, null,
        React__default["default"].createElement(uikit.Alert, { className: utils.b('pane-top-alert', {
                centered: topAlert.centered,
                dense: topAlert.dense,
            }), corners: "square", layout: "horizontal", theme: topAlert.theme || 'warning', view: topAlert.view, icon: topAlert.icon, title: topAlert.title, message: topAlert.message, actions: topAlert.actions, onClose: topAlert.closable ? handleClose : undefined }),
        React__default["default"].createElement("div", { className: utils.b('pane-top-divider') })))));
};

exports.TopPanel = TopPanel;
//# sourceMappingURL=TopPanel-33f1e6c1.js.map
